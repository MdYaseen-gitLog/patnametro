<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Metro Train Schedule</title>

  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body {
      background-color: #f0f4f8;
    }

    .highlight {
      background-color: #d1e7dd;
      font-weight: bold;
    }
  </style>
</head>

<body>
  <div class="container py-5">
    <h2 class="mb-4 text-center">üöá Metro Train Schedule & Trip Planner</h2>

    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <label for="station" class="form-label">Select Station</label>
        <select id="station" class="form-select" onchange="updateTrainInfo()">
          <option value="">-- Select Station --</option>
          <option value="Bhootnath">Bhootnath</option>
          <option value="Zero Mile">Zero Mile</option>
          <option value="New ISBT">New ISBT</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="direction" class="form-label">Select Direction</label>
        <select id="direction" class="form-select" onchange="updateTrainInfo()">
          <option value="">-- Select Direction --</option>
          <option value="North">North</option>
          <option value="South">South</option>
        </select>
      </div>
      <div class="col-md-4">
        <label for="destination" class="form-label">Select Destination</label>
        <select id="destination" class="form-select" onchange="updateTrainInfo()">
          <option value="">-- Select Destination --</option>
          <option value="Bhootnath">Bhootnath</option>
          <option value="Zero Mile">Zero Mile</option>
          <option value="New ISBT">New ISBT</option>
        </select>
      </div>
    </div>

    <div class="row g-3 mb-4">
      <div class="col-md-4">
        <div class="card text-bg-light">
          <div class="card-body">
            <h5 class="card-title">‚è∞ Current Time</h5>
            <p class="card-text" id="currentTimeDisplay">--:--</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-bg-primary text-white">
          <div class="card-body">
            <h5 class="card-title">üöâ Next Train</h5>
            <p class="card-text" id="nextTrainOutput">--:--</p>
            <p class="card-text" id="countdown">Countdown: --</p>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card text-bg-success text-white">
          <div class="card-body">
            <h5 class="card-title">üß≠ Trip Info</h5>
            <p class="card-text" id="tripInfo">--</p>
            <p class="card-text" id="frequencyInfo">Frequency: --</p>
          </div>
        </div>
      </div>
    </div>

    <div class="table-responsive">
      <table class="table table-bordered table-striped" id="trainTimesTable">
        <thead>
          <tr class="table-dark">
            <th>All Train Times</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const metroData = {
      "Bhootnath": {
        directions: {
          North: [
            { start: "08:00", end: "10:00", interval: 20 },
            { start: "10:00", end: "17:00", interval: 30 },
            { start: "17:00", end: "23:00", interval: 20 }
          ],
          South: [
            { start: "08:00", end: "10:00", interval: 20 },
            { start: "10:00", end: "17:00", interval: 30 },
            { start: "17:00", end: "23:00", interval: 20 }
          ]
        }
      },
      "Zero Mile": {
        directions: {
          North: [
            { start: "08:05", end: "10:00", interval: 20 },
            { start: "10:00", end: "17:00", interval: 30 },
            { start: "17:00", end: "23:05", interval: 20 }
          ],
          South: [
            { start: "08:05", end: "10:00", interval: 20 },
            { start: "10:00", end: "17:00", interval: 30 },
            { start: "17:00", end: "23:05", interval: 20 }
          ]
        }
      },
      "New ISBT": {
        directions: {
          North: [
            { start: "08:10", end: "10:00", interval: 20 },
            { start: "10:00", end: "17:00", interval: 30 },
            { start: "17:00", end: "23:10", interval: 20 }
          ],
          South: [
            { start: "08:10", end: "10:00", interval: 20 },
            { start: "10:00", end: "17:00", interval: 30 },
            { start: "17:00", end: "23:10", interval: 20 }
          ]
        }
      }
    };

    const travTimes = {
      "Bhootnath>Zero Mile": 2,
      "Zero Mile>New ISBT": 3,
      "New ISBT>Zero Mile": 3,
      "Zero Mile>Bhootnath": 2
    };

    const route = ["Bhootnath", "Zero Mile", "New ISBT"];

    function timeToMinutes(t) {
      const [h, m] = t.split(":").map(Number);
      return h * 60 + m;
    }

    function minutesToTime(mins) {
      const h = Math.floor(mins / 60).toString().padStart(2, '0');
      const m = (mins % 60).toString().padStart(2, '0');
      return `${h}:${m}`;
    }

    function getCurrentTimeStr() {
      const now = new Date();
      return `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
    }

    function getNextTrainTime(station, direction, currentTime) {
      const currentMins = timeToMinutes(currentTime);
      const freqs = metroData[station]?.directions[direction];

      if (!freqs) return { nextTrain: null, interval: null };

      for (const freq of freqs) {
        let start = timeToMinutes(freq.start);
        const end = timeToMinutes(freq.end);
        while (start <= end) {
          if (start >= currentMins) return { nextTrain: start, interval: freq.interval };
          start += freq.interval;
        }
      }
      return { nextTrain: null, interval: null };
    }


function getAllTrainTimes(station, direction) {
  const freqs = metroData[station]?.directions[direction];
  if (!freqs) return [];

  const result = [];
  for (const freq of freqs) {
    let t = timeToMinutes(freq.start);
    const end = timeToMinutes(freq.end);
    while (t <= end) {
      result.push(t);
      t += freq.interval;
    }
  }
  return result;
}


    function getArrivalTime(from, to, departureTime) {
      const fromIndex = route.indexOf(from);
      const toIndex = route.indexOf(to);
      if (fromIndex === -1 || toIndex === -1 || from === to) return departureTime;
      let totalMins = timeToMinutes(departureTime);
      const step = fromIndex < toIndex ? 1 : -1;
      for (let i = fromIndex; i !== toIndex; i += step) {
        const key = `${route[i]}>${route[i + step]}`;
        totalMins += travTimes[key] || 0;
      }
      return minutesToTime(totalMins);
    }

    function updateTrainInfo() {
      const station = document.getElementById("station").value;
      const direction = document.getElementById("direction").value;
      const destination = document.getElementById("destination").value;
      const currentTime = getCurrentTimeStr();
      const currentMins = timeToMinutes(currentTime);

      document.getElementById("currentTimeDisplay").textContent = currentTime;

      const { nextTrain, interval } = getNextTrainTime(station, direction, currentTime);

      if (nextTrain !== null) {
        const nextTrainStr = minutesToTime(nextTrain);
        document.getElementById("nextTrainOutput").textContent = nextTrainStr;
        document.getElementById("countdown").textContent = `Countdown: ${nextTrain - currentMins} mins`;
        document.getElementById("frequencyInfo").textContent = `Every ${interval} mins`;
      } else {
        document.getElementById("nextTrainOutput").textContent = "--";
        document.getElementById("countdown").textContent = "";
        document.getElementById("frequencyInfo").textContent = "";
      }

      if (station && destination && nextTrain !== null) {
        if (station === destination) {
          document.getElementById("tripInfo").textContent = "Trip Info: Same station selected";
        } else {
          const departTime = minutesToTime(nextTrain);
          const arriveTime = getArrivalTime(station, destination, departTime);
          const duration = timeToMinutes(arriveTime) - timeToMinutes(departTime);
          document.getElementById("tripInfo").textContent = `Depart: ${departTime}, Arrive: ${arriveTime} (Duration: ${duration} mins)`;
        }
      } else {
        document.getElementById("tripInfo").textContent = "--";
      }

      // Train Times Table
      const allTimes = getAllTrainTimes(station, direction);
      const tbody = document.querySelector("#trainTimesTable tbody");
      tbody.innerHTML = "";
      allTimes.forEach(t => {
        const row = tbody.insertRow();
        const cell = row.insertCell();
        cell.textContent = minutesToTime(t);
        if (t === nextTrain) row.classList.add("highlight");
      });
    }

    // Real-time updates
    setInterval(() => {
      const station = document.getElementById("station").value;
      const direction = document.getElementById("direction").value;
      if (station && direction) {
        updateTrainInfo();
      }
    }, 1000);
  </script>
</body>

</html>